%define distname libforms

Summary:         XForms library
Name:            @PACKAGE@
Version:         @VERSION@
Release:         1
Source0:         http://savannah.nongnu.org/download/xforms/%{name}-%{version}.tar.gz
License:         LGPLv2+
Group:           Development/Libraries

# To build the libraries and prgrams we need these packages to be installed

BuildRequires:   libXpm
BuildRequires:   libXpm-devel
BuildRequires:   libjpeg
BuildRequires:   libjpeg-devel

# Installing (and de-installing) the info format documentation requires
# the info packes

Requires(post):  info
Requires(preun): info

BuildRoot:       %{_tmppath}/%{name}-buildroot
Prefix:          %{_prefix}
URL:             http://xforms-toolkit.org/

%description
XForms is a GUI toolkit based on Xlib for X Window Systems. It
features a rich set of objects, such as buttons, sliders, and menus
etc. integrated into an easy and efficient object/event callback
execution model that allows fast and easy construction of
X-applications. In addition, the library is extensible and new objects
can easily be created and added to the library.


# Beside the normal package create a "development" package, containing
# the header files for the three libraries, the static versions of the
# libraries and the fdesign and fd2ps tools.

%package devel
Summary:         XForms development header files
Group:           Development/Libraries

%description devel
Header files, tools and static libraries for development with XForms.


# Also create a documentation package with the full documenttaion in
# info, HTML and PDF format. This is an architecture-independent
# package.
#
# Note: older rpmbuild versoopn get very unhapppy when you try to build a
# 'noarch' sub-package together with architecture-dependend packages,
# spitting out weird error messages and refusing to build the packages, so
# use 'noarch' here only with newer versions. Thanks to
# http://holyhandgrenade.org/blog/2010/09/an-annoying-and-non-obvious-rpmbuild-feature-enhancement/
# for disseminating this bit of information...

%package doc
Summary:         XForms documentation
Group:           Development/Libraries
%if 0%{?fedora} >= 10 || 0%{?rhel} >= 6 || 0%{?centos} >= 6
BuildArch:       noarch
%endif

%description doc
Info, HTML, PDF documentation and demo programs for XForms.


# Unpack the tar-ball

%prep
%setup -q


# Build everything ('make' can be done in parallel)

%build
./configure --prefix=%{_prefix} \
            --mandir=%{_mandir} \
            --bindir=%{_bindir} \
            --libdir=%{_libdir} \
            --infodir=%{_infodir} \
            --htmldir=%{_docdir}/%{distname}/html \
            --pdfdir=%{_docdir}/%{distname} \
            --enable-docs \
            --without-warnings \
            --disable-debug \
            --enable-optimization=-O2
make %{?_smp_mflags}


# Install everything in %{buildroot}, afterwards delete the dir file
# from _infodir, it's not to be distributed and gets created (or
# updated) during installation on the target machine. Remove generated
# files from

%install
rm -rf %{buildroot}
install -d -m 755 %{buildroot}
make DESTDIR=%{buildroot} install
rm -f %{buildroot}%{_infodir}/dir
rm -rf %{_builddir}/%{name}-%{version}/demos/.deps
cp -r %{_builddir}/%{name}-%{version}/demos %{buildroot}%{_docdir}/%{distname}


%clean
rm -rf %{buildroot}


# Set up list of files in the binary package: just the libraries and the
# man page for the libforms library.

%files
%{_libdir}/*.so.*
%{_mandir}/man5
%defattr(-,root,root)
%doc COPYING.LIB Copyright ChangeLog README


# Set up list of files going into the development package: header files,
# static libraries, utility programs and their man pages

%files devel
%{_bindir}
%{_includedir}
%{_libdir}/*.so
%{_libdir}/*.a
%{_libdir}/*.la
%{_mandir}/man1
%defattr(-,root,root)


# Set up list of files distributed with the documentation package:
# info, HTML, PDF documentation and demo programs

%files doc
%{_docdir}/%{distname}
%{_infodir}
%defattr(-,root,root)


# Run ldconfig after install on the target machine to make the dynamic
# linker aware of the new libraries

%post -p /sbin/ldconfig


# Run ldconfig after deinstall on the target machine of libraries

%postun -p /sbin/ldconfig


# rpmbuild gzip's image files below %{_infodir}, undo this after install of
# the documenttation on the target machine (the image files are for emacs'
# info mode and won't be recognized when gzip'ed). Then update the info
# dir file.

%post doc
gunzip %{_infodir}/xforms_images/*.png.gz
/sbin/install-info %{_infodir}/%{name}.info %{_infodir}/dir || :
ln -s %{_mandir}/man5/%{name}.5.gz %{_mandir}/man5/%{distname}.5.gz


# Remove the entry for the XForms info file from the dir file in _infdir
# when uninstalling the documentation package on the target machine. 

%preun doc
if [ $1 = 0 ] ; then
  /sbin/install-info --delete %{_infodir}/%{name}.info %{_infodir}/dir || :
  rm %{_mandir}/man5/%{distname}.5.gz
fi


%changelog
* Thu Jun 1 2010 Jens Thoms Toerring <jt@toerring.de> 1.0.93sp1
- New release 1.0.93sp1

* Wed Nov 4 2009 Jens Thoms Toerring <jt@toerring.de> 1.0.93sp1
- New release 1.0.91sp2

* Sat Nov 22 2008 Jens Thoms Toerring <jt@toerring.de> 1.0.91
- New release 1.0.91 - lots of bug fixes

* Wed Oct 6 2004 Angus Leeming <angus.leeming@btopenworld.com> 1.0.90
- Re-write the 'post' and 'postun' scripts to create the
  symbolic links correctly without requiring the SO_VERSION hack.

* Fri May 7 2004 Angus Leeming <angus.leeming@btopenworld.com> 1.0.90
- add code to the 'post' script to modify libforms.la et al. to prevent
  libtool from complaining that the files have been moved.

* Thu May 6 2004 Angus Leeming <angus.leeming@btopenworld.com> 1.0.90
- fix 'Release' and 'Source0' info.
- add 'post' and 'postun' scripts to create and remove symbolic links,
  respectively.

* Thu May 6 2004 Angus Leeming <angus.leeming@btopenworld.com> 1.0.90
- no longer place devfiles and binfiles in ${RPM_BUILD_ROOT}.
  Prevents rpm from bombing with a "Checking for unpackaged files" error.

* Sat Aug 31 2002 Duncan Haldane <duncan_haldane@users.sourceforge.net> 1.0-RC4
- mv fdesign, fd2ps to devel.  restore xforms name of rpm.

* Sun Jul 14 2002 Greg Hosler <hosler@lugs.org.sg> 1.0-RC4
- Pass DESTDIR to makeinstall_std.

* Thu Jul 11 2002 Peter Galbraith <balbraith@dfo-mpo.gc.ca> 1.0-RC4
- Move from libxforms to libforms to match other distros.

* Tue Jul 8 2002 Chris Freeze <cfreeze@alumni.clemson.edu> 1.0-RC4
- First stab at spec file.
